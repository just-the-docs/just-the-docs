{%- comment -%}
  Include as:
    {%- include components/nav/pages.html pages=page_array all=bool -%}
  Depends on:
    site.nav_urls, include.pages.
  Results in:
    HTML for the main navigation when all is nil or false;
    includes links to pages excluded from the main navigation when all is true.
  Includes:
    components/nav/links.html, components/nav/sorted.html.
  Assigns to:
    nav_url_levels, nav_top_nodes, nav_top_node_titles, nav_parenthood, nav_ancestors.
{%- endcomment -%}

{%- if site.nav_urls -%}

  {%- include components/nav/url_levels.html pages=include.pages -%}

  {%- assign nav_top_nodes = nav_url_levels[0].items -%}

  {%- comment -%}
    {%- for i in (1..nav_url_levels.size) -%}
      <br>
      {{ forloop.index0 }}: {{ nav_url_levels[forloop.index0].items | map: "title" | inspect }}
    {%- endfor -%}
  {%- endcomment -%}

{%- else -%}

  {%- assign nav_parenthood = include.pages
    | where_exp: "item", "item.title != nil" | group_by: "parent" -%}

  {%- assign nav_top_nodes = nav_parenthood
    | where_exp: "item", "item.name == ''" | map: "items" | first -%}

{%- endif -%}

{%- include components/nav/sorted.html pages=nav_top_nodes -%}

{% assign nav_top_node_titles = nav_sorted | map: "title" -%}

{%- assign nav_ancestors = "" | split: "" -%}

{%- include components/nav/links.html pages=nav_sorted ancestors=nav_ancestors all=include.all level=0 -%}
